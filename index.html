<!DOCTYPE html>
<html>

<head>
  <!-- bringing in some fonts from https://artisanthemes.io/best-google-fonts-combinations-modern-agency-website/-->
  <!--<link href="https://fonts.googleapis.com/css?family=Lora:400,700|Montserrat:300" rel="stylesheet">-->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:900|Work+Sans:300" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
  <meta charset="utf-8">
  <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script-->
  <!-- page title -->
  <div class='center'>
    <h1 style="font-weight: 1000; font-size: 50px;">Stock Finder</h1>
  </div>

  <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery.marquee@1.5.0/jquery.marquee.min.js" type="text/javascript"></script>
  <script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
    integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
    crossorigin="anonymous"></script>
  <link rel = "stylesheet"
     type = "text/css"
     href = "https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />

  <style>
  /* page background */
  body {
    background-color: #D6EAF8;
    color: #566573;
    font-family: 'Raleway', sans-serif; /*font used to be Montserrat, background: #353840, color: #ffce00*/
    font-weight: 300;
  }

  h1, h2, h3, h4, h5, h6 {
   font-family: 'Raleway', sans-serif;
   font-weight: 500;
  }

  /* center aligning everything for the object */
  .center {
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }

  /* center aligning text */
  .text-center {
    text-align: center;
  }

  /* creating a slider class */
  .rangeslider {
    text-align: left;
    font-size: medium;
    margin-bottom: 3px;
  }

  /* nav menu for tabs */
  .navmenu {
    padding: 8px 50px;
    background: transparent;
    color: #EC7063;
    font-weight: 700;
    font-family: 'Raleway', sans-serif;
    font-size: 20px;
    text-align: center;
    border-radius: 5px;
    border: 2px solid white;
    text-transform: uppercase;
  }
  #wrapper {
    display: flex;
    justify-content: center;
  }
  #wrapper > div {
    float: left;
    margin-right: 2%;
  }
  input[name = content] {
    display: none;
  }
  /*
  input[name = content] + label[class="navmenu"] {
    background: black
  }*/

  /* appearance of slider bar */
  .pagesliders {
    -webkit-appearance: none;
    background: #EC7063;
    /*width: 15%;*/
    height: 10px;
    border-radius: 100px; /* rounding the slider bars */
    opacity: 2;
    /*margin: auto;*/
  }

  /* appearance of the slider thumb thing */
  .pagesliders::-webkit-slider-thumb {
    -webkit-appearance: none;
    cursor: pointer;
    background: white;
    width: 15px;
    height: 15px;
    border-radius: 50%;
  }

  /* appearance of box to display text in */
  .displayBox {
    width: 500px;
    border-radius: 20px;
    height: 400px;
    margin: auto;
    text-align: center;
    background-color: #F1948A;
    color: #566573;
    border: 2px solid white;
  }

  /*appearance of the text boxes that comput prints to*/
  .textbox {
    width: 150px;
    height: 15px;
  }

  /*footer news headlines*/
  .footer {
    width: 100%;
    position: fixed;
    text-align: center;
    background-color: #EAF2F8;
    color: white;
    bottom: 0;
    left: 0;
    height: 50px;
  }

  .flex-container {
      display: flex;
  }

  .flex-child {
      flex: 1;
  }

  .flex-child:first-child {
      margin-right: 20px;
  }

  #API_tables {
    font-family:'Montserrat';
    font-size: small;
    display:flex;
    flex-direction: row;
    justify-content: space-evenly;
    flex-wrap: nowrap;
  }

  table{
    width: 300px;
    margin: auto;
  }

  </style>

</head>

<body>
  <br><br>
  <!-- elements of navigation menu - series of radio buttons that control each tab -->
  <div id="wrapper" style = "margin-top: -30px">
    <!-- instruction tab -->
    <div> <input type = 'radio' name = 'content' id = 'ins_lontent' checked = 'true' onclick = "display()"/>
      <label for='ins_lontent' class="navmenu" id=ins_l style="background-color:#EAF2F8">INSTRUCTIONS</label> </div>

    <!-- news tab -->
    <div> <input type = 'radio' name = 'content' id = 'news_lontent' checked = 'true' onclick = "display()"/>
      <label for='news_lontent' class="navmenu" id=news_l>NEWS</label> </div>
      <!-- preview stocks tab-->
    <div> <input type = 'radio' name = 'content' id = 'prev_lontent' checked = 'true' onclick = "display()"/>
      <label for='prev_lontent' class="navmenu" id=prev_l>PREVIEW STOCKS</label> </div>
    <!-- stock finder tab -->
    <div> <input type = 'radio' name = 'content' id = 'stk_lontent' checked = 'true' onclick = "display()"/>
      <label for='stk_lontent' class="navmenu" id=stk_l>STOCK FINDER</label> </div>

  </div>
  <br>
        <div class="flex-container">
          <div id="instructions" align="center" style="flex: 3">
            <br><br>
            <div class= 'displayBox'>
              <h1>Welcome to the Stock Finder!</h1>
              <p style="margin: 5%" align="justify">- Click on the "Stock Finder" tab to find the best stock to add to your investment portfolio.
                <br><br>- Customize your preferred stock price, PE ratio and market cap that align with your trading needs.
                <br><br>- Use the "Preview Stocks" tab to view data on your favorite stocks and compare to top competitors or other potential investments.
                <br><br>- See what's happening in the Stock Market today with the "News" tab.
                <br><br>- View the top news stories affecting market trends before making your next investment.
              </p>
            </div>
          </div>

          <div id="ins-twitter-timeline" style="position: fixed; right: 0; height: 75%">
          <a class="twitter-timeline"
            data-theme="light"
             style="height:100%"
            href="https://twitter.com/YahooFinance?ref_src=twsrc%5Etfw">
            Tweets by YahooFinance</a>
            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </div>


        <!-- <div class="flex-container"> -->
          <div id="news" style="display:none; flex: 3; position: fixed; width: 60%">
            <div class="column">
              <div id="title0"></div>
              <br><br>
              <div id="title1"></div>
              <br><br>
              <div id="title2"></div>
              <br><br>
              <div id="title3"></div>
            </div>
          </div>

        <script>
        fetch("https://finnhub.io/api/v1/news?category=general&token=btnr6jn48v6p0j27hpd0").then(r => r.json()).then(data => {
          for(let i=0; i<4; i++){
            var h=data[i].headline
            var u=data[i].url
            var t=data[i].summary
            var im=data[i].image
            $("#title"+i).append(`<img src='${im}' align="left" style="width:25%"></img>`);
            $("#title"+i).append(`<a href='${u}' target=_blank style="color:#566573">${h}</a>`);
            $("#title"+i).append('<br>');
            $("#title"+i).append(`<p style="color:#EC7063; font-size:12px">${t}</p>`);
            $("#title"+i).append('<br>');
          }
        });
        </script>
      </div>
        <!-- <div id="news-twitter-timeline" class="flex-child" align="center" style="display: none">
        <a class="twitter-timeline"
          data-theme="dark"
          height="100%"
          href="https://twitter.com/YahooFinance?ref_src=twsrc%5Etfw">
          Tweets by YahooFinance</a>
          <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div> -->

      <!-- </div> -->



        <div id="stockfinder" style="display:none">
          <!-- adding compute button -->
          <br><br>

          <!-- ADDING SLIDERS TO PAGE -->
          <!-- first slider >
          <div class="rangeslider">
            <span>Min Stock Price: <span id="value1"></span></span><br>
            <input type="range" min="0" max="5000" value ="0" class="pagesliders" id="sliderRange1">
            <br><br>
            <! commented out the textbox that the compute button ties to,
            can use the compute button for something else
            <input type="text" id="firstVal" style="text-align:center" class = "textbox"><br> >
          </div-->

          <!-- second slider
          <div class="rangeslider">
            <span>Max Stock Price: <span id="value2"></span></span><br>
            <input type="range" min="0" max="5000" value ="0" class="pagesliders" id="sliderRange2">
            <br><br>
            <! <input type="text" id="secondVal" style="text-align:center" class = "textbox"><br> >
          </div-->

          <!-- third slider
          <div class="rangeslider">
            <span>Min Price-to-Earnings Ratio: <span id="value3"></span></span><br>
            <input type="range" min="-50" max="50" value ="0" step="0.01" class="pagesliders" id="sliderRange3">
            <br><br>
          </div-->

          <!-- fourth slider
          <div class="rangeslider">
            <span>Max Price-to-Earnings Ratio: <span id="value4"></span></span><br>
            <input type="range" min="-50" max="50" value ="0" step="0.01" class="pagesliders" id="sliderRange4">
            <br><br>
          </div-->

          <!-- fifth slider
          <div class="rangeslider">
            <span>Min Market Cap (in Billions): $<span id="value5"></span></span><br>
            <input type="range" min="0" max="100" value ="0" step="0.1" class="pagesliders" id="sliderRange5">
            <br><br>
          </div-->

          <!-- sixth slider
          <div class="rangeslider">
            <span>Max Market Cap (in Billions): $<span id="value6"></span></span><br>
            <input type="range" min="0" max="100" value ="0" step="0.1" class="pagesliders" id="sliderRange6">
            <br><br>
          </div-->
        <div id="stock_flex" class="flex-container" style="width:50%; margin-left: auto; margin-right: auto;">
          <div class="flex-child" style= "flex: 1 1 auto;">
            <p style="font-size:medium;">Min/Max Stock Price:</p>
            <div style="display:flex; justify-content:space-between">
              <input type="text" id="Min_SP" style="width:70px">
              <div id=slider1 class="pagesliders" style="margin:10px; width:70%"> </div>
              <input type="text" id="Max_SP" style="width:70px">
            </div>
            <p style="font-size:medium; ">Min/Max Price-to-Earnings Ratio:</p>
            <div style="display:flex; justify-content:space-between">
              <input type="text" id="Min_PE" style="width:70px">
              <div id=slider2 class="pagesliders" style="margin:10px; width:70%"> </div>
              <input type="text" id="Max_PE" style="width:70px">
            </div>
            <p style="font-size:medium; ">Min/Max Market Cap (in Billions of dollars):</p>
            <div style="display:flex; justify-content:space-between">
              <input type="text" id="Min_MC" style="width:70px">
              <!--div id="Min_MC" style="width:70px; margin:auto; text-align: center"></div-->
              <div id=slider3 class="pagesliders" style="margin:10px; width:70%"> </div>
              <input type="text" id="Max_MC" style="width:70px">
              <!--div id="Max_MC" style="width:70px; margin:auto; text-align: center"></div-->
            </div>
            <br>
            <div class='rangeslider'>
              <text>Stock Trend: </text>
              <input type="radio" id="stockUp" name="stockTrend" value="up">
              <label for="up">Up</label>
              <input type="radio" id="stockDown" name="stockTrend" value="down">
              <label for="down">Down</label>
            </div>
          <script>
            //Script for the slider here
            $(function() {
              $( "#slider1" ).slider({
                range: true,
                min: 0,
                max: 2000,
                values: [ 0, 2000 ],
                slide: function( event, ui ) {
                  if(ui.values[0]===ui.values[1])
                    $('#slidersCompute').prop('disabled', true);
                  else
                    $('#slidersCompute').prop('disabled', false);
                  $("#Min_SP").val(ui.values[0]!==$("#slider1").slider( "option", "min" ) ? s1(ui.values[0]) : "No Min");
                  $("#Max_SP").val(ui.values[1]!==$("#slider1").slider( "option", "max" ) ? s1(ui.values[1]) : "No Max");
                }
              });
              //$("#Min_SP").val(s1($("#slider1").slider("values",0)));
              //$("#Max_SP").val(s1($("#slider1").slider("values",1)));
              $("#Min_SP").val("No Min");
              $("#Max_SP").val("No Max");
              $("#Min_SP").on("input",function(){
                $("#slider1").slider("values",0,s1i($("#Min_SP").val()))
              });
              $("#Max_SP").on("input",function(){
                $("#slider1").slider("values",1,s1i($("#Max_SP").val()))
              });
            } );
            $(function() {
              $( "#slider2" ).slider({
                range: true,
                min: 0,
                max: 400,
                values: [ 0, 400 ],
                slide: function( event, ui ) {
                  if(ui.values[0]===ui.values[1])
                    $('#slidersCompute').prop('disabled', true);
                  else
                    $('#slidersCompute').prop('disabled', false);
                  $("#Min_PE").val(ui.values[0]!==$("#slider2").slider( "option", "min" ) ? s2(ui.values[0]) : "No Min");
                  $("#Max_PE").val(ui.values[1]!==$("#slider2").slider( "option", "max" ) ? s2(ui.values[1]) : "No Max");
                  }
              });
              $("#Min_PE").val("No Min");
              $("#Max_PE").val("No Max");
              $("#Min_PE").on("input",function(){
                $("#slider2").slider(s2i("values",0,$("#Min_PE").val()))
              });
              $("#Max_PE").on("input",function(){
                $("#slider2").slider(s2i("values",1,$("#Max_PE").val()))
              });
            } );
            $(function() {
              $( "#slider3" ).slider({
                range: true,
                min: 0,
                max: 6,
                values: [ 0, 6 ],
                slide: function( event, ui ) {
                  if(ui.values[0]===ui.values[1])
                    $('#slidersCompute').prop('disabled', true);
                  else
                    $('#slidersCompute').prop('disabled', false);
                  $("#Min_MC").val(s3(ui.values[0]));
                  $("#Max_MC").val(s3(ui.values[1]));

                }
              });
              $("#Min_MC").val(s3($("#slider3").slider("values",0)));
              $("#Max_MC").val(s3($("#slider3").slider("values",1)));
              /*$("#Min_MC").on("input",function(){
                $("#slider3").slider("values",0,s3i($("#Min_MC").val()))
              });
              $("#Max_MC").on("input",function(){
                $("#slider3").slider("values",1,s3i($("#Max_MC").val()))*
              });*/
            } );
            function s1(val){
              val/=2000;
              return Math.round(2000*val**2);
            }
            function s1i(val){
              val/=2000;
              return Math.sqrt(val)*2000;
            }
            function s2(val){
              val/=400
              return Math.round(400*val**2 + 10);
            }
            function s2i(val){
              val = (val-10)/400
              return 400*(val**(1/2));
            }
            function s3(val){
              let values = ["No Min","0.05","0.3","2","10","200","No Max"];
              return values[val];
            }
          </script>
          <br>
          <div style="text-align:center">
            <input id="slidersReset" type="button" value="Reset">
            <button id=slidersCompute type="button" onclick="$('#stock_flex').css('width','100%'); getStock(); $('#screener_table').show()">Compute</button>
            <button id=slidersCompute type="button" onclick="$('#stock_flex').css('width','100%'); clearStock(); $('#screener_table').show()">Clear</button>
          </div>
          <script>
            $('#slidersReset').click(function(){
              $('#screener_table').hide();
              $('#stock_flex').css('width',"50%");
              $("#Min_SP").val("No Min");
              $("#Max_SP").val("No Max");
              $("#Min_PE").val("No Min");
              $("#Max_PE").val("No Max");
              $("#Min_MC").val("No Min");
              $("#Max_MC").val("No Max");
              $("#slider1").slider("values",0,0);
              $("#slider1").slider("values",1,2000);
              $("#slider2").slider("values",0,0);
              $("#slider2").slider("values",1,400);
              $("#slider3").slider("values",0,0);
              $("#slider3").slider("values",1,6);
              //$('#stockUp').attr('checked',false);
              //$('#stockDown').attr('checked',false);
              document.getElementById("stockUp").checked = false;
              document.getElementById("stockDown").checked = false;
              document.getElementById('ins-twitter-timeline').style.display = "block";
            });
          </script>
        </div>

          <div id="screener_table" class="flex-child" style=" flex: 2 1 auto; display:none;">
            <table border=1 cellpadding=10 style="width:80%">
              <thead>
                <tr>
                  <th>
                    Stock Symbol
                  </th>
                  <th>
                    Company Name
                  </th>
                  <th>
                    Current Stock Price
                  </th>
                  <th>
                    Market Cap
                  </th>
                  <th>
                    Last Annual Dividend
                  </th>
                  <th>
                    Sector
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <p id="Stock0Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock0companyName"></p>
                  </td>
                  <td>
                    <p id="Stock0Price"></p>
                  </td>
                  <td>
                    <p id="Stock0Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock0Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock0Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock1Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock1companyName"></p>
                  </td>
                  <td>
                    <p id="Stock1Price"></p>
                  </td>
                  <td>
                    <p id="Stock1Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock1Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock1Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock2Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock2companyName"></p>
                  </td>
                  <td>
                    <p id="Stock2Price"></p>
                  </td>
                  <td>
                    <p id="Stock2Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock2Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock2Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock3Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock3companyName"></p>
                  </td>
                  <td>
                    <p id="Stock3Price"></p>
                  </td>
                  <td>
                    <p id="Stock3Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock3Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock3Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock4Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock4companyName"></p>
                  </td>
                  <td>
                    <p id="Stock4Price"></p>
                  </td>
                  <td>
                    <p id="Stock4Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock4Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock4Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock5Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock5companyName"></p>
                  </td>
                  <td>
                    <p id="Stock5Price"></p>
                  </td>
                  <td>
                    <p id="Stock5Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock5Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock5Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock6Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock6companyName"></p>
                  </td>
                  <td>
                    <p id="Stock6Price"></p>
                  </td>
                  <td>
                    <p id="Stock6Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock6Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock6Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock7Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock7companyName"></p>
                  </td>
                  <td>
                    <p id="Stock7Price"></p>
                  </td>
                  <td>
                    <p id="Stock7Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock7Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock7Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock8Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock8companyName"></p>
                  </td>
                  <td>
                    <p id="Stock8Price"></p>
                  </td>
                  <td>
                    <p id="Stock8Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock8Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock8Sector"></p>
                  </td>
                </tr>
                <tr>
                  <td>
                    <p id="Stock9Symbol"></p>
                  </td>
                  <td>
                    <p id="Stock9companyName"></p>
                  </td>
                  <td>
                    <p id="Stock9Price"></p>
                  </td>
                  <td>
                    <p id="Stock9Market Cap"></p>
                  </td>
                  <td>
                    <p id="Stock9Last Annual Dividend"></p>
                  </td>
                  <td>
                    <p id="Stock9Sector"></p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          </div>
          <br><br><br>
        </div>


        <div id="preview" style="display:none">
          <div id='stockstats'>
            <h3 class=text-center>Preview Stocks</h3>
            <div class=text-center>
              <label for="symbol">Enter stock symbol:</label> <input type=text id='symbol' size=5>
              <button type=button id='symbolbutton' onclick="stockbutton()"
              disabled>Add</button>
              <br>
            </div>

          </div>
          <div id = "API_tables"> </div>
          <br>
          <div id='stat_buttons' class="text-center" style='display:none'>
            <button onclick=tableclear()>Clear All</button>
            <button onclick=refreshAll()>Refresh All</button>
          </div>
          <p id=tablemessage class="text-center"></p>

      </div>

        <!-- adding footer news headline -->
    <div class = "footer">
      <strong style="color: #566573">Top Market News Headlines:</strong>
      <div id="NewsHeadline" style="color: #566573">
      </div>
    </div>


        <!-- SCRIPTS -->

        <script>
        $('#NewsHeadline').hide();
        fetch("https://finnhub.io/api/v1/news?category=general&token=btnr6jn48v6p0j27hpd0").then(r => r.json()).then(data => {
          let i=0;
          let s="";
          for(let c=0; c<10; c++){
            let h = data[i].headline;
            let u = data[i].url;
            i++;
            if(h===""){
              c--;
              continue;
            }
            $("#NewsHeadline").append(`<a href='${u}' target=_blank>${h}</a>`);
            if(c!==9)
              $("#NewsHeadline").append(" &nbsp;&nbsp;|| &nbsp;&nbsp;");
          }
          $('#NewsHeadline').marquee({
            pauseOnHover:true,
            speed:100
          });

        }, r => {$("#NewsHeadline").html("API fetch failed");})
        $('#NewsHeadline').show();
        </script>

        <!--script to control display of tabs -->
        <script>
        function display() {
          let ins = document.getElementById('instructions'); // refers to content of instructions tab
          let news = document.getElementById('news'); // refers to content of news tab
          let prev = document.getElementById('preview')
          let stk = document.getElementById('stockfinder'); // refers to content of stock finder tab
          let ins_twit = document.getElementById('ins-twitter-timeline');
          let news_twit = document.getElementById('news-twitter-timeline');

          let ins_l = document.getElementById("ins_l");
          let news_l = document.getElementById("news_l");
          let prev_l = document.getElementById("prev_l")
          let stk_l = document.getElementById("stk_l");

          if (document.getElementById("ins_lontent").checked) { // instruction tab is selected
            ins.style.display = "block";
            ins_twit.style.display = "block"
            news.style.display = "none";
            //news_twit.style.display = "none";
            prev.style.display= "none";
            stk.style.display = "none";
            ins_l.style["background-color"]="#EAF2F8";
            news_l.style["background-color"]="";
            prev_l.style["background-color"]="";
            stk_l.style["background-color"]="";
          }

          else if (document.getElementById("news_lontent").checked) { // news tab is selected
            ins.style.display = "none";
            ins_twit.style.display = "block"
            news.style.display = "block";
            //news_twit.style.display = "block";
            prev.style.display= "none";
            stk.style.display = "none";
            ins_l.style["background-color"]="";
            news_l.style["background-color"]="#EAF2F8";
            prev_l.style["background-color"]="";
            stk_l.style["background-color"]="";
          }
          else if (document.getElementById("prev_lontent").checked){
            ins.style.display = "none";
            ins_twit.style.display = "block"
            news.style.display = "none";
            prev.style.display= "block";
            stk.style.display = "none";
            ins_l.style["background-color"]="";
            news_l.style["background-color"]="";
            prev_l.style["background-color"]="#EAF2F8";
            stk_l.style["background-color"]="";
          }
          else if (document.getElementById("stk_lontent").checked) { // stock finder tab is selected
            ins.style.display = "none";
            ins_twit.style.display = "block"
            news.style.display = "none";
            prev.style.display= "none";
            stk.style.display = "block";
            ins_l.style["background-color"]="";
            news_l.style["background-color"]="";
            prev_l.style["background-color"]="";
            stk_l.style["background-color"]="#EAF2F8";
          }
        }
        </script>
        <!-- script to display value of sliders  -->
        <script>

        </script>
        <script>
        const generateLink = () =>{
          let link = "https://finviz.com/screener.ashx?v=111&o=price&";
          //Slider1:
          let min1 = Number($("#Min_SP").val());
          let max1 = Number($("#Max_SP").val());
          let min2 = Number($("#Min_PE").val());
          let max2 = Number($("#Max_PE").val());
          let min3 = Number($("#Min_MC").val());
          let max3 = Number($("#Max_MC").val());
          if(min1 || max1){ //falsy
            if(!max1)
              link += `sh_price_o${min1},`;
            else if(!min1)
              link += `sh_price_u${max1},`;
            else
              link += `sh_price_${min1}to${max1},`;
          }
          if(min2 || max2){
            if(!max2)
              link+=`fa_pe_o${min2},`;
            else if(!min2)
              link+=`fa_pe_u${max2},`;
            else
              link+=`fa_pe_${min2}to${max2},`
          }
          if(min3 || max3){
            if(!max3)
              max3 = "";
            if(!min3)
              min3 = "";
            link += `f=cap_${min3}to${max3},`;
          }
          return link;
        }

        const parse = function(html){
          const cells = ($(html)).find(".screener-link-primary");
          //.table-dark-row-cp, .table-light-row-cp
          //console.log(rows.html());
          const data = [];
          for(let i=0; i<10; i++){
            data.push(cells.eq(i).html());
          }
          return data;
        };
        async function getStock() {
          /*
          let minMC = 0;
          let maxMC = 1000000000000000000;
          if ($("#Min_MC").val(s3($("#slider3").slider("values",0))) === 0) {
            minMC = 0;
          }
          let minMC = $("#Max_MC").val(s3($("#slider3").slider("values",1))) * 1000000000;
          if ($("#Max_MC").val(s3($("#slider3").slider("values",1))) === 6) {
            maxMC = 1000000000000000000;
          }
          let maxMC = $("#Max_MC").val(s3($("#slider3").slider("values",1))) * 1000000000;
          */
          //let stringMin = minMC.toString();
          //let stringMax = maxMC.toString();
          const html = (await (await fetch("https://cors-anywhere.herokuapp.com/"+generateLink())).text());
          const tickers = parse(html);
          console.log(tickers);



          /*
          fetch("https://financialmodelingprep.com/api/v3/stock-screener?marketCapMoreThan=1000000&exchange=NASDAQ&limit=100&apikey=83de5b39af0c5c7e1b5c156e8bc04eaf").then(r => r.json()).then(data=>{
            for (var i = 0; i < 10; i++) {
              document.getElementById("Stock"+i+"Symbol").innerHTML = data[i].symbol;
              document.getElementById("Stock"+i+"companyName").innerHTML = data[i].companyName;
              document.getElementById("Stock"+i+"Price").innerHTML = data[i].price;
              document.getElementById("Stock"+i+"Market Cap").innerHTML = data[i].marketCap;
              document.getElementById("Stock"+i+"Last Annual Dividend").innerHTML = data[i].lastAnnualDividend;
              document.getElementById("Stock"+i+"Sector").innerHTML = data[i].sector;
            }
          });*/
          for(let i=0; i<tickers.length; i++){
            fetch("https://financialmodelingprep.com/api/v3/quote/"+tickers[i]+"?apikey=3b6ef1b7be0d570de6d6f72d4ee46ea5").then(r => r.json()).then(data=>{
              /*$(`#Stock${i}Symbol`).html(data.symbol);
              $(`#Stock${i}companyName`).html(data.companyName);
              $(`#Stock${i}Price`).html(data.price);
              $(`#Stock${i}Market Cap`).html(data.marketCap);
              $(`#Stock${i}Last Annual Dividend`).html(data.lastAnnualDividend);
              $(`#Stock${i}Sector`).html(data.sector);*/
              data=data[0];
              document.getElementById("Stock"+i+"Symbol").innerHTML = data.symbol;
              document.getElementById("Stock"+i+"companyName").innerHTML = data.name;
              document.getElementById("Stock"+i+"Price").innerHTML = data.price;
              document.getElementById("Stock"+i+"Market Cap").innerHTML = data.marketCap;
              //document.getElementById("Stock"+i+"Last Annual Dividend").innerHTML = data.lastAnnualDividend;
              //document.getElementById("Stock"+i+"Sector").innerHTML = data.sector;
            });
            fetch("https://financialmodelingprep.com/api/v3/profile/"+tickers[i]+"?apikey=3b6ef1b7be0d570de6d6f72d4ee46ea5").then(r => r.json()).then(data=>{
              data=data[0];
              document.getElementById("Stock"+i+"Last Annual Dividend").innerHTML = data.lastDiv;
              document.getElementById("Stock"+i+"Sector").innerHTML = data.sector;
            });
          }
          document.getElementById('ins-twitter-timeline').style.display = "none";
        }
        </script>

        <script>
        //<!-- API pull code -->
        var num_tables=0;
        var table_codes = [];
        document.getElementById("symbol").addEventListener("keyup", function(event) {
          var nameInput = document.getElementById('symbol').value;
          if (event.keyCode === 13 && nameInput != "" && num_tables<4) {
            // Cancel the default action, if needed
            //event.preventDefault();
            // Trigger the button element with a click
            document.getElementById("symbolbutton").click();/*
            stockbutton();
            document.getElementById('symbolbutton').setAttribute('disabled', true);
            document.getElementById('symbol').value = '';*/
          }
          else if (nameInput != "" && num_tables<4) {
            document.getElementById('symbolbutton').removeAttribute("disabled");
          } else {
            document.getElementById('symbolbutton').setAttribute("disabled", null);
          }
        });

        function stockbutton(){
          if(num_tables==4)
          return;
          //tablefetch(num_tables+1, document.getElementById("symbol").value.toUpperCase(), true);
          addTable($("#symbol").val().toUpperCase());
          //document.getElementById('symbolbutton').setAttribute('disabled', null);
          $('#symbolbutton').attr('disabled', null);
          //document.getElementById('symbol').value = '';
          $('#symbol').val("");
          //console.log(table_codes);
        }

        function addTable(code){
          document.getElementById('ins-twitter-timeline').style.display = "none";
          if(typeof code==="undefined")
          return;
          if(table_codes.includes(code)){
            $("#tablemessage").html(code+" table already exists");
            return;
          }
          $("#tablemessage").html("Fetching...");
          fetch("https://finnhub.io/api/v1/quote?symbol="+code+"&token=btnr6jn48v6p0j27hpd0").then(r => r.json()).then(data=>{
            if(data.o==0 && data.h==0 && data.l==0 && data.c==0 && data.pc==0){
              $("#tablemessage").html("Invalid Stock Symbol");
            }
            else{
              let table_html = `
              <div id=table${code}>
              <table border=\"5\">
              <tr>
              <th colspan=\"5\"><br>
              <h3>${code} Stock Data</h3>
              </th>
              </tr>

              <th>Open</th>
              <th>High</th>
              <th>Low</th>
              <th>Current</th>
              <th>Previous Close</th>

              <tr>
              <td><div id=\"Open${code}\"></div></td>
              <td><div id=\"High${code}\"></div></td>
              <td><div id=\"Low${code}\"></div></td>
              <td><div id=\"Current${code}\"></div></td>
              <td><div id=\"PrevClose${code}\"></div></td>
              </tr>
              </table>
              <div class=text-center>
              <button onclick=removeTable(\"${code}\")>Delete</button>
              <button onclick=refresh(\"${code}\")>Refresh</button>
              </div>
              </div>
              `;
              $(table_html).appendTo("#API_tables");
              $("#Open"+code).html(data.o);
              $("#High"+code).html(data.h);
              $("#Low"+code).html(data.l);
              $("#Current"+code).html(data.c);
              $("#PrevClose"+code).html(data.pc);
              document.getElementById('stat_buttons').style.display="";
              $("#tablemessage").html("");
              table_codes.push(code);
              num_tables++;
            }
          }, error=>{$("tablemessage").html("Fetch Failed")});
        }

        function removeTable(code){
          num_tables--;
          let n = table_codes.indexOf(code);
          table_codes.splice(n,1); //remove from table
          $(`#table${code}`).remove();
          if(num_tables==0)
          document.getElementById('stat_buttons').style.display="none";
        }
        function refresh(code){
          $("#tablemessage").html("Fetching...");
          fetch("https://finnhub.io/api/v1/quote?symbol="+code+"&token=btnr6jn48v6p0j27hpd0").then(r => r.json()).then(data=>{
            $("#Open"+code).html(data.o);
            $("#High"+code).html(data.h);
            $("#Low"+code).html(data.l);
            $("#Current"+code).html(data.c);
            $("#PrevClose"+code).html(data.pc);
            $("#tablemessage").html("");
          }, error=>{document.getElementById("tablemessage").innerHTML = "Fetch Failed"})
        }

        function refreshAll(){
          console.log(num_tables);
          for(let i=0; i<num_tables; i++){
            console.log(table_codes[i]);
            refresh(table_codes[i]);
          }
        }
        function tableclear(){
          console.log(table_codes);
          for(let i=num_tables-1; i>=0; i--){
            //document.getElementById('t'+(i+1)).style.display="none";
            removeTable(table_codes[i]);
          }
          document.getElementById('stat_buttons').style.display="none";
          num_tables=0;
          table_codes=[];
          document.getElementById("tablemessage").innerHTML = "";
          document.getElementById('ins-twitter-timeline').style.display = "block";
        }

      </script>

</body>

</html>
